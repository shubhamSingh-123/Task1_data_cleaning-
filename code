"""
Auto Data Cleaning Script
Supports ZIP files containing CSV or Excel (.xlsx)
Cleans duplicates, missing values, and standardizes column names.
"""

import zipfile
import os
import pandas as pd

def unzip_data(zip_file, extract_dir="unzipped_data"):
    os.makedirs(extract_dir, exist_ok=True)
    with zipfile.ZipFile(zip_file, 'r') as z:
        z.extractall(extract_dir)
    print(f"âœ… ZIP extracted to '{extract_dir}'")
    return extract_dir

def detect_files(folder):
    csv_files, xlsx_files = [], []
    for root, _, files_in_dir in os.walk(folder):
        for f in files_in_dir:
            if f.endswith(".csv"):
                csv_files.append(os.path.join(root, f))
            elif f.endswith(".xlsx"):
                xlsx_files.append(os.path.join(root, f))
    return csv_files, xlsx_files

def read_file(csv_files, xlsx_files):
    if csv_files:
        file_path = csv_files[0]
        print(f"ğŸ“„ Reading CSV file: {file_path}")
        return pd.read_csv(file_path)
    elif xlsx_files:
        file_path = xlsx_files[0]
        print(f"ğŸ“„ Reading Excel file: {file_path}")
        return pd.read_excel(file_path)
    else:
        raise FileNotFoundError("âŒ No CSV or XLSX file found!")

def clean_data(df):
    df = df.drop_duplicates()
    df = df.fillna("Unknown")
    df.columns = df.columns.str.lower().str.replace(" ", "_")
    return df

def save_cleaned(df, output_dir="results", file_name="cleaned_dataset.csv"):
    os.makedirs(output_dir, exist_ok=True)
    path = os.path.join(output_dir, file_name)
    df.to_csv(path, index=False)
    print(f"ğŸ‰ Cleaned data saved to '{path}'")
    return path

def main():
    zip_file = input("ğŸ“¤ Enter your ZIP file path (e.g., data/archive.zip): ")
    extracted_folder = unzip_data(zip_file)
    csv_files, xlsx_files = detect_files(extracted_folder)
    df = read_file(csv_files, xlsx_files)
    df_cleaned = clean_data(df)
    save_cleaned(df_cleaned)

if __name__ == "__main__":
    main()